<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>World Recipe Quest</title>
    <!-- Chargement de la police moderne "Inter" -->
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;700;800&display=swap" rel="stylesheet">
    
    <style>
        /* Définition des variables "Premium Nuit" (Défaut) AVEC ACCENT ROUGE */
        :root {
            --bg-primary: #121212;      /* Fond principal (Presque noir) */
            --bg-secondary: #1E1E1E;    /* Fond des panneaux (Gris très sombre) */
            --bg-tertiary: #333333;     /* Fond des inputs et bordures */
            --text-primary: #F5F5F5;    /* Texte principal (Presque blanc) */
            --text-secondary: #888888;  /* Texte grisé (Muted) */
            --accent: #DC2626;          /* Accent (ROUGE VIF) */
            --accent-hover: #B91C1C;    /* Accent au survol (ROUGE FONCÉ) */
            --card-border: #333333;     /* Bordure des cartes */
        }

        /* Thème "Gourmet Clair" (Mode Jour) - S'active quand le body a la classe .light-mode */
        body.light-mode {
            --bg-primary: #F9FAFB;
            --bg-secondary: #FFFFFF;
            --bg-tertiary: #E5E7EB;
            --text-primary: #1F2937;
            --text-secondary: #6B7280;
            --accent: #DC2626;     /* Rouge 600 (Cohérent) */
            --accent-hover: #B91C1C; /* Rouge 700 (Cohérent) */
            --card-border: #E5E7EB;
        }

        /* Réinitialisation de base */
        * {
            box-sizing: border-box;
            margin: 0;
            padding: 0;
        }

        /* Thème Moderne / Futuriste */
        body {
            font-family: 'Inter', sans-serif; /* Police lisible */
            font-size: 16px;
            background-color: var(--bg-primary);
            color: var(--text-primary);
            padding: 20px;
            -webkit-font-smoothing: antialiased;
            -moz-osx-font-smoothing: grayscale;
            transition: background-color 0.3s ease, color 0.3s ease;
        }

        h1, h2, h3 {
            font-weight: 700;
        }

        h1 {
            font-size: 28px;
            font-weight: 800;
            text-align: center;
            margin-bottom: 30px;
            color: var(--text-primary);
            letter-spacing: -0.5px;
        }
        
        h2 {
            font-size: 14px;
            margin-bottom: 15px;
            color: var(--accent); /* Accent (Rouge ou Ambre) */
            text-transform: uppercase;
            letter-spacing: 0.5px;
        }
        
        h3 {
            font-size: 18px;
            color: var(--text-primary);
            margin-bottom: 4px;
            font-weight: 700;
        }

        /* Conteneur principal */
        .container {
            max-width: 1200px;
            margin: 0 auto;
            height: calc(100vh - 40px);
            display: flex;
            flex-direction: column;
        }

        /* Panneaux (anciennement .window-box) */
        .window-box {
            background-color: var(--bg-secondary); /* Fond panneau */
            border: 1px solid var(--card-border); /* Bordure légère */
            border-radius: 12px; /* Coins arrondis */
            box-shadow: 0 4px 6px -1px rgba(0, 0, 0, 0.1), 0 2px 4px -2px rgba(0, 0, 0, 0.1); /* Ombre subtile */
            margin-bottom: 25px;
            padding: 24px;
            transition: background-color 0.3s ease, border-color 0.3s ease;
        }
        
        /* Grille de mise en page (structure conservée) */
        .main-layout {
            display: grid;
            grid-template-columns: 300px 1fr;
            gap: 25px;
            flex-grow: 1;
            min-height: 0;
        }
        
        /* Adaptation Mobile Parfaite */
        @media (max-width: 900px) {
            body {
                padding: 15px;
            }
            .container {
                height: auto;
            }
            .main-layout {
                grid-template-columns: 1fr;
                gap: 15px; /* Espace réduit sur mobile */
            }
            .window-box {
                padding: 15px; /* Padding réduit sur mobile */
            }
            h1 {
                font-size: 24px;
                margin-bottom: 20px;
            }
            .type-buttons {
                gap: 8px; /* Grille plus serrée */
            }
            .checkbox-group {
                gap: 8px;
            }
        }
        
        aside.window-box {
             margin-bottom: 0;
        }
        
        main.window-box {
            display: flex;
            flex-direction: column;
            margin-bottom: 0;
        }

        /* --- FILTRES (Panneau de Contrôle) --- */
        
        .filter-group {
            margin-bottom: 24px;
        }
        
        .filter-group label {
            display: block;
            margin-bottom: 10px;
            font-weight: 500;
            color: var(--text-secondary);
            font-size: 14px;
        }

        select, .pixel-button {
            font-family: 'Inter', sans-serif;
            font-size: 15px;
            background-color: var(--bg-primary); /* Fond (inset) */
            color: var(--text-primary);
            border: 1px solid var(--bg-tertiary);
            padding: 10px 12px;
            width: 100%;
            border-radius: 8px; /* Coins arrondis */
            transition: border-color 0.2s ease, box-shadow 0.2s ease, background-color 0.3s ease, color 0.3s ease;
        }
        
        select:focus, input:focus {
            outline: none;
            border-color: var(--accent);
            box-shadow: 0 0 0 3px color-mix(in srgb, var(--accent) 20%, transparent); /* Lueur d'accent */
        }

        /* Boutons (anciennement .pixel-button) */
        .pixel-button {
            cursor: pointer;
            text-align: center;
            font-weight: 600;
            text-transform: none;
            border: 1px solid var(--bg-tertiary);
            background-color: transparent;
            color: var(--text-secondary);
            transition: all 0.2s ease-in-out;
        }
        
        @media (hover: hover) {
            .pixel-button:not(.active):not(.locked):hover {
                background-color: var(--bg-tertiary);
                border-color: var(--bg-tertiary);
                color: var(--text-primary);
            }
        }

        .type-buttons {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 10px;
        }
        
        /* Bouton Actif (Style de base) */
        .pixel-button.active {
            border-color: var(--accent);
            font-weight: 600;
            background-color: var(--accent); /* Rouge solide pour les DEUX modes */
            color: #FFFFFF; /* Texte blanc pour les DEUX modes */
        }
        
        /* Mode Jour (Rouge subtil) */
        body.light-mode .pixel-button.active {
            /* Style maintenant géré par .pixel-button.active ci-dessus */
        }
        
        /* Mode Nuit (Rouge Vif) */
        body:not(.light-mode) .pixel-button.active {
            /* Style maintenant géré par .pixel-button.active ci-dessus */
        }

        .pixel-button.locked {
            background-color: var(--bg-tertiary);
            color: var(--text-secondary);
            opacity: 0.6;
            cursor: not-allowed;
            border-color: var(--bg-tertiary);
        }

        /* Slider de temps */
        input[type="range"] {
            -webkit-appearance: none;
            width: 100%;
            height: 6px;
            background: var(--bg-tertiary);
            border-radius: 3px;
            padding: 0;
            border: none;
        }
        
        input[type="range"]::-webkit-slider-thumb {
            -webkit-appearance: none;
            appearance: none;
            width: 18px;
            height: 18px;
            background: var(--accent);
            border: 3px solid var(--bg-secondary);
            border-radius: 50%;
            cursor: pointer;
            transition: background-color 0.2s ease;
        }

        input[type="range"]::-webkit-slider-thumb:hover {
            background: var(--accent-hover);
        }
        
        #time-value {
            color: var(--text-primary);
            font-size: 15px;
            font-weight: 500;
            text-align: right;
            margin-top: 8px;
        }

        /* Checkboxes modernes */
        .checkbox-group {
            display: grid;
            grid-template-columns: repeat(2, minmax(min-content, 1fr));
            gap: 10px;
        }
        
        .checkbox-label {
            display: flex;
            align-items: center;
            cursor: pointer;
            font-size: 15px;
            color: var(--text-secondary);
            transition: color 0.2s ease;
            white-space: nowrap; /* Correction layout "Légumineuse" */
        }
        
        .checkbox-label:hover {
            color: var(--text-primary);
        }
        
        .checkbox-label input {
            display: none;
        }
        
        .checkbox-label .custom-checkbox {
            width: 18px;
            height: 18px;
            background-color: var(--bg-primary);
            border: 2px solid var(--bg-tertiary);
            border-radius: 4px;
            margin-right: 10px;
            display: inline-flex;
            align-items: center;
            justify-content: center;
            position: relative;
            transition: all 0.2s ease;
            flex-shrink: 0; /* Empêche le checkbox de rétrécir */
        }
        
        .checkbox-label input:checked + .custom-checkbox {
            background-color: var(--accent);
            border-color: var(--accent);
        }

        .checkbox-label .custom-checkbox::after {
            content: '';
            position: absolute;
            display: none;
            width: 4px;
            height: 8px;
            border: solid white;
            border-width: 0 2px 2px 0;
            transform: rotate(45deg);
            top: 2px;
        }

        .checkbox-label input:checked + .custom-checkbox::after {
            display: block;
        }

        /* --- LISTE DE RECETTES --- */
        #recipe-list {
            flex-grow: 1;
            min-height: 0;
            overflow-y: auto;
            padding: 10px;
            background-color: var(--bg-primary);
            border: 1px solid var(--bg-tertiary);
            border-radius: 8px;
        }
        
        /* Scrollbar moderne */
        #recipe-list::-webkit-scrollbar {
            width: 10px;
        }
        #recipe-list::-webkit-scrollbar-track {
            background: var(--bg-primary);
            border-radius: 10px;
        }
        #recipe-list::-webkit-scrollbar-thumb {
            background-color: var(--bg-tertiary);
            border-radius: 10px;
            border: 2px solid var(--bg-primary);
        }
        #recipe-list::-webkit-scrollbar-thumb:hover {
            background-color: var(--text-secondary);
        }

        .recipe-card {
            background-color: var(--bg-secondary);
            border: 1px solid var(--card-border);
            padding: 16px;
            margin-bottom: 12px;
            border-radius: 10px;
            box-shadow: 0 2px 4px rgba(0,0,0,0.03);
            transition: transform 0.2s ease, box-shadow 0.2s ease, border-color 0.2s ease;
        }

        .recipe-card:hover {
            border-color: var(--accent);
            transform: translateY(-2px);
            box-shadow: 0 4px 10px rgba(0,0,0,0.05);
        }
        
        body.light-mode .recipe-card:hover {
             box-shadow: 0 4px 10px rgba(0,0,0,0.07);
        }
        
        .recipe-card-header {
            display: flex;
            justify-content: space-between;
            align-items: flex-start;
            margin-bottom: 12px;
        }
        
        .recipe-original-name {
            font-size: 16px;
            color: var(--accent);
            font-weight: 500;
        }
        
        .recipe-origin {
            font-size: 15px;
            color: var(--text-secondary);
            text-align: right;
            flex-shrink: 0;
            padding-left: 10px;
        }

        .recipe-info {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 12px;
            border-top: 1px dashed var(--bg-tertiary);
            border-bottom: 1px dashed var(--bg-tertiary);
            padding: 10px 0;
        }
        
        .recipe-time {
            font-size: 15px;
            color: var(--text-primary);
            font-weight: 600;
        }
        
        .recipe-tags {
            display: flex;
            gap: 6px;
            flex-wrap: wrap;
        }
        
        /* Tags monochromes et professionnels */
        .tag {
            font-family: 'Inter', sans-serif;
            font-size: 11px;
            font-weight: 500;
            padding: 4px 10px;
            border-radius: 99px; /* Pill shape */
            text-transform: uppercase;
            letter-spacing: 0.5px;
            background-color: var(--bg-tertiary); /* Gris clair */
            color: var(--text-secondary); /* Gris moyen */
        }
        
        /* Thème sombre : Tags plus foncés */
        body:not(.light-mode) .tag {
            background-color: #2a2a2a;
            color: #9CA3AF;
        }
        
        /* Thème clair : Tags plus clairs */
        body.light-mode .tag {
             background-color: #F3F4F6;
             color: #4B5563;
        }
        
        /* Exception "Piquant" pour les deux modes (Cohérent avec l'accent ROUGE) */
        body:not(.light-mode) .tag.tag-epice_piquant { 
            background-color: #450a0a; /* Rouge Nuit Fond */
            color: #F87171; /* Rouge Nuit Texte */
        }
         body.light-mode .tag.tag-epice_piquant { 
            background-color: #FEE2E2; /* Rouge Jour Fond */
            color: #B91C1C; /* Rouge Jour Texte */
        }

        /* AMÉLIORATION : Distinction Description / Ingrédients (Inversé) */
        .recipe-description {
            margin-bottom: 12px;
            font-size: 15px;
            color: var(--text-primary); /* Description en couleur principale */
            line-height: 1.6;
        }
        
        .recipe-ingredients {
            font-size: 14px;
            color: var(--text-secondary); /* Ingrédients en retrait (grisé) */
            line-height: 1.5;
        }
        .recipe-ingredients strong {
            color: var(--text-secondary); /* Titre "Ingrédients" aussi en retrait */
            font-weight: 600; /* Garder un peu de poids */
        }

    </style>
</head>

<body>

    <div class="container">
        <h1>World Recipe Quest</h1>

        <div class="main-layout">
            
            <aside class="window-box" id="filters-ui">

                <div class="filter-group">
                    <button class="pixel-button" id="theme-toggle" style="width: 100%; background-color: var(--bg-tertiary); color: var(--text-primary);">Passer au Mode Jour</button>
                </div>
                
                <div class="filter-group">
                    <h2>Type de Plat</h2>
                    <div class="type-buttons">
					    <button class="pixel-button active" data-type="Mijoté">Mijoté</button>
					    <button class="pixel-button active" data-type="Sauté">Sauté</button>
					    <button class="pixel-button active" data-type="Grill">Grill</button>
					    <button class="pixel-button active" data-type="Soupe">Soupe</button>
						<button class="pixel-button active" data-type="Vapeur">Vapeur</button>
                        <button class="pixel-button active" data-type="Four / Rôtir">Four / Rôtir</button>
                        <button class="pixel-button active" data-type="Frire">Frire</button>
                        <button class="pixel-button active" data-type="Froid / Cru">Froid / Cru</button>
				    </div>
                </div>

                <div class="filter-group">
                    <h2>Destination</h2>
                    <label for="continent-filter">Continent:</label>
                    <select id="continent-filter">
                        <option value="Tous">-- TOUS --</option>
                    </select>
                </div>
                <div class="filter-group">
                    <label for="country-filter">Pays:</label>
                    <select id="country-filter">
                        <option value="Tous">-- TOUS --</option>
                    </select>
                </div>

                <div class="filter-group">
                    <h2>Temps Prépa (Max)</h2>
                    <input type="range" id="time-filter" min="30" max="720" value="720" step="15">
                    <div id="time-value">Jusqu'à 12h 00m</div>
                </div>

                <div class="filter-group">
                    <h2>Ingrédients</h2>
                    <div class="checkbox-group">
                        <label class="checkbox-label">
                            <input type="checkbox" class="tag-filter" value="viande">
                            <span class="custom-checkbox"></span>
                            Viande
                        </label>
						<label class="checkbox-label">
                            <input type="checkbox" class="tag-filter" value="poisson">
                            <span class="custom-checkbox"></span>
                            Poisson
                        </label>
                        <label class="checkbox-label">
                            <input type="checkbox" class="tag-filter" value="fruit_de_mer">
                            <span class="custom-checkbox"></span>
                            Fruits de mer
                        </label>
						<label class="checkbox-label">
                            <input type="checkbox" class="tag-filter" value="legumes">
                            <span class="custom-checkbox"></span>
                            Légumes
                        </label>
						<label class="checkbox-label">
                            <input type="checkbox" class="tag-filter" value="riz">
                            <span class="custom-checkbox"></span>
                            Riz
                        </label>
                        <label class="checkbox-label">
                            <input type="checkbox" class="tag-filter" value="pates">
                            <span class="custom-checkbox"></span>
                            Pâtes
                        </label>
                        <label class="checkbox-label">
                            <input type="checkbox" class="tag-filter" value="legumineuse">
                            <span class="custom-checkbox"></span>
                            Légumineuse
                        </label>
                        <label class="checkbox-label">
                            <input type="checkbox" class="tag-filter" value="cereales">
                            <span class="custom-checkbox"></span>
                            Céréales
                        </label>
						<label class="checkbox-label">
                            <input type="checkbox" class="tag-filter" value="oeuf">
                            <span class="custom-checkbox"></span>
                            Oeuf
                        </label>
						<label class="checkbox-label">
                            <input type="checkbox" class="tag-filter" value="champignons">
                            <span class="custom-checkbox"></span>
                            Champignons
                        </label>
                        <label class="checkbox-label">
                            <input type="checkbox" class="tag-filter" value="epices">
                            <span class="custom-checkbox"></span>
                            Épices
                        </label>
                        <label class="checkbox-label">
                            <input type="checkbox" class="tag-filter" value="herbes">
                            <span class="custom-checkbox"></span>
                            Herbes
                        </label>
                        <label class="checkbox-label">
                            <input type="checkbox" class="tag-filter" value="epice_piquant">
                            <span class="custom-checkbox"></span>
                            Piquant
                        </label>
                        <label class="checkbox-label">
                            <input type="checkbox" class="tag-filter" value="vegetarien">
                            <span class="custom-checkbox"></span>
                            Végétarien
                        </label>
                    </div>
                </div>
                
                 <div class="filter-group">
                    <!-- Ce bouton utilise la même classe .pixel-button pour que le JS le trouve -->
                    <button class="pixel-button" id="reset-button" style="background-color: var(--bg-tertiary); color: var(--text-primary);">RESET FILTRES</button>
                 </div>

            </aside>
            
            <main class="window-box">
                <h2 id="recipe-count">Chargement des recettes...</h2>
                <div id="recipe-list">
                    <!-- Les cartes de recettes seront insérées ici par le JS -->
                </div>
            </main>

        </div>
    </div> 

<script>
let allRecipes = [];
					 
                // --- DÉFINITIONS DES TAGS D'INGRÉDIENTS (Corrigée avec Exclusions) ---
        const tagDefinitions = {
            
            // Catégorie simple (Pas d'exclusions nécessaires)
            viande: ["viande", "viandes","bœuf", "beef", "agneau", "porc", "poulet", "veau", "canard", "lapin", "chèvre", "mouton", "saucisse", "lardons", "gibier", "os à moelle", "queue de bœuf", "tripes", "coq", "poule", "jambon", "spam", "cheval", "kefta", "pancetta", "confit", "lard", "renne", "bacon", "kangourou", "döner", "chorizo", "merguez", "dumba", "wurst", "gammon", "corned beef", "andouille", "boudin", "morcilla", "chouriço", "farinheira", "carne seca", "foie", "tête de porc", "joue", "oreille", "gosht", "char siu", "boerewors", "sang", "saindoux", "suif", "rognons", "graisse", "graisse de bœuf", "graisse d'oie", "Bouillon de bœuf", "Bouillon de poulet", "Bouillon de porc"],
            
           // Catégorie simple (Pas d'exclusions nécessaires)
            poisson: ["poisson", "poissons", "haddock fumé", "lotte", "thon", "anchois", "saumon", "poissons de roche", "morue", "maquereau", "anguille", "sériole", "barramundi", "congre", "mahimahi", "thiof", "flocons de bonite", "katsuobushi", "ikan bilis", "cabillaud", "sole", "bar", "vivaneau", "truite", "sardine", "hareng", "tilapia"],
            
			// Catégorie simple (Pas d'exclusions nécessaires)
            fruit_de_mer: ["crevette", "crevettes", "moule", "moules", "palourde", "palourdes", "crabe", "calamar", "calamars", "fruits de mer", "seiche", "gambas", "écrevisse", "écrevisses", "homard", "huître", "huîtres", "poulpe", "coque", "coques", "pâte de crevette", "bagoong", "terasi", "mắm ruốc", "yet", "surimi", "oursin", "œufs de poisson", "tobiko", "œufs de saumon", "ikura", "belacan", "langoustine", "pétoncle", "coquille saint-jacques", "lambi"],

            // Catégorie simple (Doit inclure les dérivés)
            oeuf: ["œuf", "oeuf", "œufs", "oeufs", "jaune d'œuf", "blancs d'œufs", "œuf dur", "œufs durs", "omelette", "œufs de caille"],

            // Exclut les légumineuses sèches (pois chiches, haricots secs)
            legumes: {
                includes: ["carotte", "oignon", "poireau", "tomate", "aubergine", "chou", "pomme de terre", "poivron", "céleri", "navet", "ail", "courge", "betterave", "olive", "maïs", "rutabaga", "panais", "cornichon", "okra", "gombo", "radis", "manioc", "plantain", "igname", "kimchi", "choucroute", "épinard", "kumara", "potiron", "artichaut", "concombre", "roquette", "cresson", "liseron d'eau", "orties", "oseille", "daikon", "konjac", "racine de lotus", "renkon", "gobo", "racine de bardane", "tomatillo", "chayotte", "mu er", "germes de soja", "feuilles de taro", "taro", "papaye verte", "jicama", "fleur de bananier", "algues", "wakame", "nori", "kombu", "cavolo nero", "nopales", "cardons", "poire coréenne", "jujubes", "haricots verts", "haricots longs", "petits pois"],
                excludes: ["pois chiches", "pois cassés", "haricots (lingots)", "haricots (Tarbais)", "haricots (Fabas)", "haricots (borlotti)", "haricots (cannellini)", "haricots (secs)", "farine de pois chiches", "champignon", "champignons", "shiitake", "pleurotes", "cèpes", "girolles", "morilles", "truffe", "champignons de Paris", "champignons noirs", "oreilles de Judas", "kikurage", "enoki"]
            },

            // Exclut l'huile et les graines (qui sont des épices/herbes)
            epices: {
                includes: ["paprika", "cumin", "safran", "cannelle", "clou de girofle", "ras el hanout", "curry", "curcuma", "gingembre", "anis étoilé", "poivre", "baies de genièvre", "quatre-épices", "moutarde", "cardamome", "galanga", "pâte de roucou", "achiote", "sumac", "fenugrec", "fenouil", "tamarin", "cinq-épices", "amchur", "grains de paradis", "asafoetida", "hing", "ajwain", "mastic", "noix de muscade", "anis", "coriandre (graines)"],
                excludes: ["huile de sésame"] // "sésame" est dans legumineuse
            },

            // Exclut la graine (qui est une épice)
            herbes: {
                includes: ["thym", "laurier", "coriandre", "persil", "romarin", "basilic", "aneth", "menthe", "origan", "sauge", "citronnelle", "feuilles de curry", "feuilles de combava", "pandan", "marjolaine", "sarriette", "ciboulette", "estragon", "livèche", "épazote", "kra pao", "ciboule", "guascas", "uziza", "utazi", "rau ram", "kroeung"],
                excludes: ["coriandre (graines)"]
            },
    
            // Exclut les produits dérivés (vinaigre, farine, nouilles)
            riz: {
                includes: ["riz", "galettes de riz", "poudre de riz grillé"],
                excludes: ["vinaigre de riz", "farine de riz", "nouilles de riz", "vermicelles de riz", "vin de riz"]
            },

            // Exclut les farines d'autres catégories
            cereales: {
                includes: ["quinoa", "semoule", "couscous", "millet", "orge", "blé", "avoine", "polenta", "sarrasin", "pain", "chapelure", "seigle", "farine", "farine de maïs", "cornmeal"],
                excludes: ["farine de riz", "farine de pois chiches"]
            },

            // Exclut les nouilles à base de riz ou de légumineuses
            pates: {
                includes: ["pâtes", "nouilles", "vermicelles", "orzo", "ramen", "udon", "spätzle", "spaghetti", "lasagnes", "cannelloni", "gnocchi", "macaroni", "wonton", "soba", "knedlíky"],
                excludes: ["nouilles de riz", "vermicelles de riz", "vermicelles de soja", "nouilles de patate douce"]
            },

            // Exclut les légumes (haricots verts), les huiles et les sauces
            legumineuse: {
                includes: ["haricot", "lentille", "pois chiche", "fève", "pois cassés", "pois", "haricots mungo", "tofu", "graines de courge", "pepitas", "cacahuètes", "arachide", "soja", "farine de pois chiches", "besan", "tempeh", "tahini", "sésame", "pignons de pin", "pâte d'arachide"],
                excludes: ["haricots verts", "haricots longs", "petits pois", "sauce soja", "lait de soja", "huile de sésame", "huile d'arachide"]
            },
			
			champignons: ["champignon", "champignons", "shiitake", "pleurotes", "cèpes", "girolles", "morilles", "truffe", "champignons de Paris", "champignons noirs", "oreilles de Judas", "kikurage", "enoki"],

            // Catégorie simple (Mots-clés très spécifiques)
            epice_piquant: ["piment", "piments", "pimentée", "piquant", "harissa", "gochugaru", "gochujang", "doubanjiang", "berbéré", "épices cajun", "cajun", "sambal", "sriracha", "piment de Cayenne", "cayenne", "chili", "poudre de chili", "pâte de chili", "huile de piment", "scotch bonnet", "habanero", "serrano", "jalapeño", "jalapeños", "ancho", "guajillo", "pasilla", "poblano", "guindilla", "guindillas", "aji amarillo", "aji panca", "aji limo", "siling labuyo", "siling haba", "piment oiseau", "pul biber", "piment d'Alep", "piment du Cachemire", "Kashmiri", "paprika (fort)", "poivre du Sichuan", "pâte de curry rouge", "pâte de curry vert", "pâte de curry jaune", "pâte de Laksa", "Nam Prik Pao", "sauce pimentée", "Rotel", "sahawiq", "Tom Yum", "Colombo", "Mitmita"],
            
            // Catégorie spéciale (logique)
            vegetarien: [] 
        };

        // --- ÉLÉMENTS DU DOM ---
        const continentFilter = document.getElementById('continent-filter');
        const countryFilter = document.getElementById('country-filter');
        const timeFilter = document.getElementById('time-filter');
        const timeValue = document.getElementById('time-value');
        const tagFilters = document.querySelectorAll('.tag-filter');
        const recipeList = document.getElementById('recipe-list');
        const recipeCount = document.getElementById('recipe-count');
        const resetButton = document.getElementById('reset-button');
        const themeToggle = document.getElementById('theme-toggle'); // Ajout du bouton Thème
        
        let populatedContinents = [];
        let populatedCountries = [];
		let selectedRecipeTypes = ["Mijoté", "Sauté", "Grill", "Soupe", "Vapeur", "Four / Rôtir", "Frire", "Froid / Cru"];

        // --- FONCTIONS AUXILIAIRES ---

        /**
         * Génère des tags pour une recette en fonction de ses ingrédients.
         */
        function generateTags(recipe) {
            const tags = new Set();
            const ingredientsLower = recipe.ingredients.join(' ').toLowerCase(); 
            const recipeId = recipe.id;
            
            let hasViande = false;
            let hasPoisson = false;
            let isKnownVeggie = false; // Flag pour les recettes végétariennes connues

            // IDs Végétariens connus (basé sur la base de données fournie)
            const allKnownVeggieIDs = new Set([
                76, 80, 85, 102, 111, 131, 132, 179, 180, 185, 186, 200, 212, 216, 227, 229, 245, 
                246, 254, 264, 266, 279, 283, 284, 293, 294, 296, 308, 310, 311, 312, 313, 
                316, 317, 318, 321, 322, 323, 334, 336, 338, 339, 340, 351, 358, 366, 
                371, 384, 388, 398, 406, 465, 506, 511, 515, 518
                // ... (et beaucoup d'autres IDs de la liste originale)
            ]);

            if (allKnownVeggieIDs.has(recipeId)) {
                isKnownVeggie = true;
            }

            // Boucle sur les définitions de tags
            for (const [tag, config] of Object.entries(tagDefinitions)) {
                if (tag === 'vegetarien') continue;

                // Détermine les listes d'inclusion et d'exclusion
                const includesKeywords = Array.isArray(config) ? config : config.includes;
                const excludesKeywords = Array.isArray(config) ? [] : (config.excludes || []);

                // 1. Vérifie si un mot-clé d'inclusion est présent
                if (includesKeywords.some(keyword => ingredientsLower.includes(keyword))) {
                    
                    // 2. Vérifie si un mot-clé d'exclusion est également présent
                    const isExcluded = excludesKeywords.some(excludeKeyword => ingredientsLower.includes(excludeKeyword));
                    
                    // 3. N'ajoute le tag que s'il n'est PAS exclu
                    if (!isExcluded) {
                        tags.add(tag);
                        if (tag === 'viande') hasViande = true;
                        if (tag === 'poisson' || tag === 'fruit_de_mer') hasPoisson = true;
                    }
                }
            }
            
            // Logique Végétarien (inchangée)
            if (hasViande || hasPoisson) {
                tags.delete('vegetarien');
            } else {
                if (isKnownVeggie || (!hasViande && !hasPoisson)) {
                    tags.add('vegetarien');
                }
            }
            
            return Array.from(tags);
        }

        /**
         * Formate les minutes en "Xh Ym"
         */
        function formatTime(minutes) {
            const h = Math.floor(minutes / 60);
            const m = minutes % 60;
            let timeString = "";
            if (h > 0) timeString += `${h}h `;
            if (m > 0) timeString += `${m.toString().padStart(2, '0')}m`;
            return timeString || "0m";
        }

        /**
         * Crée la carte HTML pour une recette.
         */
        function createRecipeCard(recipe) {
            const card = document.createElement('div');
            card.className = 'recipe-card';
            
            const tagsHTML = recipe.tags.map(tag => {
                let tagName = tag.replace(/_/g, ' ');
                if (tagName === 'poisson fruit de mer') tagName = 'poisson'; // Raccourci
                return `<span class="tag tag-${tag}">${tagName.toUpperCase()}</span>`;
            }).join('');

            const displayedIngredients = recipe.ingredients.join(', ');

            card.innerHTML = `
                <div class="recipe-card-header">
                    <div>
                        <h3>${recipe.name}</h3>
                        <div class="recipe-original-name">${recipe.originalName}</div>
                    </div>
                    <div class="recipe-origin">${recipe.flag} ${recipe.country}<br>(${recipe.continent})</div>
                </div>
                <div class="recipe-info">
                    <div class="recipe-time">${formatTime(recipe.prepTime)}</div>
                    <div class="recipe-tags">${tagsHTML}</div>
                </div>
                <div class="recipe-description">${recipe.description}</div>
                <div class="recipe-ingredients"><strong>Ingrédients:</strong> ${displayedIngredients}</div>
            `;
            return card;
        }
		
// --- LOGIQUE PRINCIPALE ---

        /**
         * Peuple les filtres (Continents) au démarrage.
         */
        function populateFilters() {
            const continents = new Set();
            const countries = new Set();
            
            allRecipes.forEach(recipe => {
                recipe.tags = generateTags(recipe); 
                
                continents.add(recipe.continent);
                countries.add(recipe.country);
            });
            
            populatedContinents = Array.from(continents).sort((a, b) => a.localeCompare(b, 'fr', { sensitivity: 'base' }));
            populatedCountries = Array.from(countries).sort((a, b) => a.localeCompare(b, 'fr', { sensitivity: 'base' }));
            
            // Ajoute les options pour les continents
            continentFilter.innerHTML = '<option value="Tous">-- TOUS --</option>'; // Réinitialise
            populatedContinents.forEach(continent => {
                const option = document.createElement('option');
                option.value = continent;
                option.textContent = continent;
                continentFilter.appendChild(option);
            });
            
            // Initialise le filtre pays avec tous les pays
            updateCountryFilter(true);
        }

        /**
         * Met à jour le filtre des pays en fonction du continent sélectionné.
         */
        function updateCountryFilter(initial = false) {
            const selectedContinent = continentFilter.value;
            const currentCountryValue = countryFilter.value; 
            
            countryFilter.innerHTML = '<option value="Tous">-- TOUS --</option>';
            
            let countriesToShow;
            
            if (selectedContinent === 'Tous') {
                countriesToShow = populatedCountries;
            } else {
                const countries = new Set();
                allRecipes.forEach(recipe => {
                    if (recipe.continent === selectedContinent) {
                        countries.add(recipe.country);
                    }
                });
                countriesToShow = Array.from(countries).sort((a, b) => a.localeCompare(b, 'fr', { sensitivity: 'base' }));
            }

            countriesToShow.forEach(country => {
                const option = document.createElement('option');
                option.value = country;
                option.textContent = country;
                countryFilter.appendChild(option);
            });

            if (countriesToShow.includes(currentCountryValue)) {
                 countryFilter.value = currentCountryValue;
            } else if (!initial) {
                 countryFilter.value = 'Tous';
            }
        }

        /**
         * Affiche les recettes filtrées.
         */
        function renderRecipes() {
            // Récupère les filtres actuels
            const filters = {
                continent: continentFilter.value,
                country: countryFilter.value,
                maxTime: parseInt(timeFilter.value, 10),
                tags: Array.from(tagFilters)
                            .filter(input => input.checked)
                            .map(input => input.value)
            };
            
            // Applique les filtres
            const filteredRecipes = allRecipes.filter(recipe => {
                // 1. Filtre Type de Plat (obligatoire)
                if (selectedRecipeTypes.length === 0 || !selectedRecipeTypes.includes(recipe.type)) {
                    return false;
                }
                // 2. Filtre Continent
                if (filters.continent !== 'Tous' && recipe.continent !== filters.continent) {
                    return false;
                }
                // 3. Filtre Pays
                if (filters.country !== 'Tous' && recipe.country !== filters.country) {
                    return false;
                }
                // 4. Filtre Temps
                if (recipe.prepTime > filters.maxTime) {
                    return false;
                }
                // 5. Filtre Tags (la recette doit avoir TOUS les tags sélectionnés)
                if (filters.tags.length > 0 && !filters.tags.every(tag => recipe.tags.includes(tag))) {
                    return false;
                }
                
                return true;
            });
            
            // Vide la liste
            recipeList.innerHTML = '';
            
            // Met à jour le compteur
            recipeCount.textContent = `${filteredRecipes.length} RECETTES TROUVÉES`;
            
            // Affiche les recettes
            if (filteredRecipes.length === 0) {
                recipeList.innerHTML = '<div class="recipe-card"><h3>Aucune recette trouvée!</h3><p>Essayez d\'élargir vos filtres.</p></div>';
            } else {
                // Trie par pays (linguistiquement correct) puis par nom.
                filteredRecipes.sort((a, b) => {
                    const countryComparison = a.country.localeCompare(b.country, 'fr', { sensitivity: 'base' });
                    
                    if (countryComparison !== 0) {
                        return countryComparison;
                    }

                    return a.name.localeCompare(b.name, 'fr', { sensitivity: 'case' });
                });
                
                filteredRecipes.forEach(recipe => {
                    recipeList.appendChild(createRecipeCard(recipe));
                });
            }
        }
        
        /**
         * Réinitialise tous les filtres à leur état par défaut.
         */
        function resetFilters() {
            continentFilter.value = 'Tous';
            updateCountryFilter(); 
            countryFilter.value = 'Tous';
            timeFilter.value = 720;
            timeValue.textContent = 'Jusqu\'à 12h 00m';
            tagFilters.forEach(input => input.checked = false);
            
			// Réinitialise le tableau des types
            selectedRecipeTypes = ["Mijoté", "Sauté", "Grill", "Soupe", "Vapeur", "Four / Rôtir", "Frire", "Froid / Cru"];
    
            // Met à jour les classes des boutons pour tout ACTIVER
            document.querySelectorAll('.type-buttons .pixel-button').forEach(btn => {
                 if (selectedRecipeTypes.includes(btn.dataset.type)) {
                     btn.classList.add('active');
                 } else {
                     // S'assure que les boutons "locked" restent locked (au cas où la recette test n'existe pas)
                     if (!btn.disabled) {
                        btn.classList.remove('active');
                     }
                 }
             });
			
            renderRecipes();
        }

        // --- INITIALISATION et ÉVÉNEMENTS ---
        document.addEventListener('DOMContentLoaded', () => {
    
            // 1. DÉMARRAGE DU CHARGEMENT ASYNCHRONE
            fetch('recettes.json') // Assurez-vous que le nom du fichier est correct
                .then(response => {
                    // Vérifie que le fichier a été trouvé et chargé correctement
                    if (!response.ok) {
                        throw new Error(`Erreur HTTP! Statut: ${response.status}. Le fichier 'recettes.json' n'a pas été trouvé ou chargé.`);
                    }
                    return response.json(); // Convertit le texte JSON en objet JavaScript
                })
                .then(data => {
                    // 2. STOCKAGE DES DONNÉES
                    allRecipes = data; // <--- Les données sont enfin disponibles ici

                    // 3. DÉMARRAGE DE L'APPLICATION (Ancien code d'initialisation)
                    
                    // Pré-traitement et marquage des recettes
                    populateFilters(); 

                    // Verrouillage des types non représentés
                    document.querySelectorAll('.type-buttons .pixel-button').forEach(btn => {
                        const type = btn.dataset.type;
                        const hasRecipes = allRecipes.some(recipe => recipe.type === type);
                        if (!hasRecipes) {
                            btn.classList.add('locked');
                            btn.disabled = true;
                            const index = selectedRecipeTypes.indexOf(type);
                            if (index > -1) {
                                 selectedRecipeTypes.splice(index, 1);
                             }
                        }
                        
                        if (selectedRecipeTypes.includes(btn.dataset.type) && !btn.disabled) {
                            btn.classList.add('active');
                        }
                    });
                    
                    // Rendu initial
                    renderRecipes(); 
                    
                    // --- GESTION DES BOUTONS DE TYPE ---
                    const typeButtonsContainer = document.querySelector('.type-buttons');
                    typeButtonsContainer.addEventListener('click', (event) => {
                        const clickedButton = event.target.closest('.pixel-button');

                        if (clickedButton && clickedButton.dataset.type && !clickedButton.disabled) {
                            const type = clickedButton.dataset.type;
                            const index = selectedRecipeTypes.indexOf(type);
        
                            if (index > -1) {
                                selectedRecipeTypes.splice(index, 1);
                                clickedButton.classList.remove('active');
                            } else {
                                selectedRecipeTypes.push(type);
                                clickedButton.classList.add('active');
                            }
                            renderRecipes();
                        }
                    });

                    // Ajout des écouteurs d'événements pour les filtres standards
                    continentFilter.addEventListener('change', () => {
                        updateCountryFilter();
                        renderRecipes();
                    });
                    countryFilter.addEventListener('change', renderRecipes);
                    timeFilter.addEventListener('input', () => {
                        timeValue.textContent = `Jusqu'à ${formatTime(parseInt(timeFilter.value, 10))}`;
                    });
                    timeFilter.addEventListener('change', renderRecipes); 
                    
                    tagFilters.forEach(input => {
                        input.addEventListener('change', renderRecipes);
                    });
                    
                    resetButton.addEventListener('click', resetFilters);

                    // --- GESTIONNAIRE DU THÈME ---
                    themeToggle.addEventListener('click', () => {
                        document.body.classList.toggle('light-mode');
                        const isLight = document.body.classList.contains('light-mode');
                        themeToggle.textContent = isLight ? 'Passer au Mode Nuit' : 'Passer au Mode Jour';
                    });
                
                })
                .catch(error => {
                    // 4. GÉRER L'ERREUR (si le JSON n'est pas chargé)
                    console.error("Erreur de chargement du fichier recettes.json:", error);
                    document.getElementById('recipe-count').textContent = "ERREUR: Recettes non chargées. Vérifiez recettes.json.";
                });
					
        });
    </script>
</body>
</html>


